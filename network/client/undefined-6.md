---
description: '맵, 아이템 동기화 등'
---

# 그 외 동기화 구현

## 기본 원리 

Host - Peer 방식을 사용  
Host가 결정한 내용을 Peer가 따라하는 방식

![](../../.gitbook/assets/image%20%2824%29.png)

## 방 동기화 

### 방 생성 동기화 

이론 

1. Host가 다음 방 목록\(포탈\) 결정
2. Host는 방 목록을 서버에 전달 
3. 서버는 Host, Peer에게 2의 내용을 전달 
4. Host, Peer가 서버로부터 온 내용을 수행 

구현 

* 방 생성과 다음 방 목록\(포탈\) 결정, 다음 방 목록 생성 분리 
  * 방 생성 : 포탈 생성 안 함 
  * 다음 방 목록\(포탈\) 결정 : 호스트만 수행. 
  * 다음 방 목록\(포탈\) 생성 : '다음 방 목록 결정' 내용을 읽고 포탈 생성 
* 
### 방 이동 동기화 

![](../../.gitbook/assets/image%20%2823%29.png)

0. 방 생성 동기화로 방 생성 목록?은 동기화되었다고 가정  
1. 각 클라이언트가 이동 수락/거절 신호를 보냄  
\(현재는 시간 내에 수락/거절 신호를 보낸다고 가정\)  
2-1. 수락 시 수락 신호\(자신의 플레이어 번호\) -&gt; 활성화된 플레이어 수만큼 수락 시 3으로 넘어감   
2-2. 거절 시 거절 신호 -&gt; 이동 취소    
3. 

## 아이템 동기화 

참고 : 아이템 소유 방식을 개인 단위로 볼지 팀 단위로 볼지 결정하고 실질적인 아이템 동기화를 만들 예정 

개인 단위 

* 아이템을 개별적으로 획득
* 드랍 아이템은 해당 플레이어에게만 보임 
* 아이템 드랍 테이블은 개인 단위? 팀 단위? 선택 필요 
* 아이템 공유 기능 역시 생각해볼 필요가 있음 

팀 단위

* 아이템은 팀 단위로 획득
* 드랍 아이템은 모든 플레이어에게 공유됨 
  * 모든 플레이어가 같은 아이템을 볼 수 있음 
  * 한 플레이어가 해당 아이템을 획득하면 모든 플레이어는 해당 아이템을 더 이상 획득할 수 없음 
* 아이템 드랍 테이블은 팀 단위 
  * \(몬스터\) 아이템 드랍은 Host를 기준으로 
    * 몬스터 죽음 알림\(전체\) -&gt; Host가 아이템 드랍\(번호\) -&gt; 아이템 드랍을 실제로 적용 
  * 아이템 드랍 테이블은 Host 선 갱신, Peer 후 갱신 방식 
    * 아이템 드랍 테이블을 동기화하지 않으면 이후 Host가 나갔을 때 드랍 테이블이 망가지기 때문에 동기화 필요 
    * 동기화를 위해 아이템 드랍 번호만 얻기 -&gt; 아이템 번호에 따른 아이템 드랍 방식을 사용해 드랍 테이블을 갱신 & 동기화화면 아이템 연속 드랍 시 같은 아이템을 드랍할 위험이 있음 
    * 아이템 
  * 팝업 등으로 아이템을 획득한 경우 Peer의 아이템 드랍 테이블을 사용? 고민 필요 
    * Host의 아이템 드랍 테이블을 사용하면 아이템 중복 드랍에선 안전하지만 딜레이 및 복잡한 과정 필요  \(아이템 드랍 요청 -&gt; Host에게 아이템 번호 받기 -&gt; 받은 번호로 실제 아이템 드랍\) 
    * Peer의 아이템 드랍 테이블을 사용 시 구현이 상대적으로 쉽지만 상황에 따라 아이템 중복 드랍이 일어날 수 있음  \(아이템 선 드랍 -&gt; 서버에 알림 -&gt; 전체 유저에게 적용\)
* 한 플레이어가 아이템을 드랍하면 모든 플레이어에게 아이템 드랍이 보여짐 



